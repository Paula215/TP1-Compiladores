cmake_minimum_required(VERSION 3.20)

# Habilitamos C y C++ (LLVM hace algunos checks en C)
project(BiolingoOptDemo C CXX)

set(CMAKE_BUILD_TYPE Debug)
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# ============================
# Encontrar LLVM
# ============================
find_package(LLVM REQUIRED CONFIG)
message(STATUS "Found LLVM ${LLVM_PACKAGE_VERSION}")
message(STATUS "Using LLVMConfig.cmake in: ${LLVM_DIR}")

# Necesitamos esta utilidad para mapear componentes → librerías
include(AddLLVM)

# ============================
# Fuentes del proyecto
# ============================
file(GLOB SOURCES "*.cpp")
add_executable(${PROJECT_NAME} ${SOURCES})

# ============================
# Librerías LLVM a usar
# ============================
# Aquí listamos los componentes que necesitamos. Para este ejemplo,
# core + support + passes + analysis + ipo son suficientes para
# utilizar PassBuilder y el pipeline O2.
#
# NOTA: Si en Windows o en otra máquina diera algún símbolo faltante,
# se puede agregar algún componente más a la lista (por ejemplo:
# "scalaropts", "transformutils", etc.).
llvm_map_components_to_libnames(LLVM_LIBS
    core
    support
    passes
    analysis
    ipo
)

target_link_libraries(${PROJECT_NAME} PRIVATE ${LLVM_LIBS})

# ============================
# Includes y flags de LLVM
# ============================
target_include_directories(
  ${PROJECT_NAME} PRIVATE
  ${LLVM_INCLUDE_DIRS}
)

add_definitions(${LLVM_DEFINITIONS})